import React, { useState, useEffect } from 'react';
import {
    View,
    StyleSheet,
    ScrollView,
    Alert, Modal, Pressable,
} from 'react-native';
import { Text, Button, Thumbnail, Spinner, Container, Header, Content, Card, CardItem, Body, Left, Right } from 'native-base';
import { Col, Row, Grid } from 'react-native-easy-grid';
import axios from 'axios'
import url from "../core/index";
import { useGlobalState, useGlobalStateUpdate } from '../context/context';


export default function Materials() {
    const [materials, setMaterials] = useState();
    const [loading, setLoading] = useState(true);
    const globalStateUpdate = useGlobalStateUpdate();
    const globalState = useGlobalState();
    const [modalVisible, setModalVisible] = useState(false);

    useEffect(() => {
        axios({
            method: 'get',
            url: `${url}/get-materials`,
        }).then((res) => {
            setMaterials(res.data.materials);
            setLoading(false);
        }).catch((err) => {
            setLoading(true);
        })
    }, []);

    const addMaterial = (index) => {
        var old_materials = [...materials];
        old_materials[index].added = true,
            setMaterials(old_materials);
        console.log('selected material ', materials[index]);
        globalStateUpdate((prevValue) => ({ ...prevValue, cart: [...globalState.cart, materials[index]], role: 'haha' }));
        // globalStateUpdate((prevValue) => ({ ...prevValue, loginStatus: false }))
    }

    return (


        <Container>
            {loading ? <Spinner />
                :

                <Grid >
                    <Row>
                        <ScrollView>
                            <Col>
                                <Card style={styles.card}>
                                    {materials.map((value, index) => {
                                        return <CardItem key={index}>
                                            <Body style={styles.card}>
                                                <Thumbnail source={{ uri: value.url }}></Thumbnail>
                                                <Text style={{ textAlign: 'center' }}>{value.name}</Text>
                                                <Button onPress={() => value.added === true ? () => { return } : addMaterial(index)} style={{ alignSelf: 'center' }} success><Text>{value.added === true ? 'Added' : 'Add Material'}</Text></Button>
                                            </Body>
                                        </CardItem>
                                    })
                                    }
                                </Card>
                            </Col>
                        </ScrollView>
                    </Row>
                </Grid>
            }
             <View style={styles.centeredView}>
      <Modal
        animationType="slide"
        transparent={true}
        visible={modalVisible}
        onRequestClose={() => {
          Alert.alert("Modal has been closed.");
          setModalVisible(!modalVisible);
        }}
      >
        <View style={styles.centeredView}>
          <View style={styles.modalView}>
            <Text style={styles.modalText}>Hello World!</Text>
            <Pressable
              style={[styles.button, styles.buttonClose]}
              onPress={() => setModalVisible(!modalVisible)}
            >
              <Text style={styles.textStyle}>Hide Modal</Text>
            </Pressable>
          </View>
        </View>
      </Modal>
      <Pressable
        style={[styles.button, styles.buttonOpen]}
        onPress={() => setModalVisible(true)}
      >
        <Text style={styles.textStyle}>Show Modal</Text>
      </Pressable>
    </View>
        </Container>
    )
}

const styles = new StyleSheet.create({
    card: {
        width: '100%',
        textAlign: 'center',
        justifyContent: 'center',
        alignItems: 'center',
        display: 'flex',
        backgroundColor: 'lightgreen',
        padding: 20,
    },
    centeredView: {
        flex: 1,
        justifyContent: "center",
        alignItems: "center",
        marginTop: 22
      },
      modalView: {
        margin: 20,
        backgroundColor: "white",
        borderRadius: 20,
        padding: 35,
        alignItems: "center",
        shadowColor: "#000",
        shadowOffset: {
          width: 0,
          height: 2
        },
        shadowOpacity: 0.25,
        shadowRadius: 4,
        elevation: 5
      },
      button: {
        borderRadius: 20,
        padding: 10,
        elevation: 2
      },
      buttonOpen: {
        backgroundColor: "#F194FF",
      },
      buttonClose: {
        backgroundColor: "#2196F3",
      },
      textStyle: {
        color: "white",
        fontWeight: "bold",
        textAlign: "center"
      },
      modalText: {
        marginBottom: 15,
        textAlign: "center"
      }
})